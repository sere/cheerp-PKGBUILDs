# Maintainer: Yuri Iozzelli <y.iozzelli@gmail.com>
pkgname=cheerp-libcxx
pkgver=cheerp.1.3.r17.g9123b88b
pkgrel=1
epoch=
pkgdesc="A C++ compiler for the Web, C++ library implementation"
arch=("x86_64")
url="leaningtech.com/cheerp"
license=('GPL2')
groups=()
depends=("cheerp-llvm-clang" "cheerp-utils" "cheerp-newlib")
makedepends=()
checkdepends=()
optdepends=()
provides=()
conflicts=()
replaces=()
backup=()
options=('!strip')
install=
changelog=
source=("git+https://github.com/leaningtech/cheerp-libcxx.git"
"git+https://github.com/leaningtech/cheerp-libcxxabi.git")
md5sums=('SKIP'
         'SKIP')
pkgver() {
	cd $srcdir/cheerp-libcxx
	git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
	cd $srcdir/cheerp-libcxx
	mkdir -p build
	cd build
	cmake -DCMAKE_INSTALL_PREFIX=/opt/cheerp \
	      -DCMAKE_BUILD_TYPE=Release \
	      -DCMAKE_TOOLCHAIN_FILE=/opt/cheerp/share/cmake/Modules/CheerpToolchain.cmake \
	      -DLIBCXX_ENABLE_SHARED=OFF \
	      -DLIBCXX_ENABLE_ASSERTIONS=OFF \
	      -DLIBCXX_CXX_ABI_INCLUDE_PATHS=$srcdir/cheerp-libcxxabi/include \
	      -DLIBCXX_CXX_ABI=libcxxabi \
	      -DCHEERP_MODE=genericjs \
	      -DCMAKE_CXX_FLAGS="-target cheerp -nostdlib -frtti" ..
}

build() {
	cd $srcdir/cheerp-libcxx/build
	make
}

package() {
	cd $srcdir/cheerp-libcxx/build
	make DESTDIR=$pkgdir install

}
